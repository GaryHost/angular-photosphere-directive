"Author : Florent Gros";"use strict";var photosphere=angular.module("photosphere",[]);photosphere.directive("ngScopeElement",function(){var a={restrict:"A",compile:function(){return{pre:function(a,b,c){a[c.ngScopeElement]=b}}}};return a}),photosphere.directive("photosphere",["$window",function(a){var b="sphere"+Math.round(1e5*Math.random()),c="<style> ul{list-style-type:none;margin:0;padding:0;overflow:hidden}li{float:left}a:link,a:visited{display:block;width:120px;font-weight:700;color:#FFF;background-color:#98bf21;text-align:center;padding:4px;text-decoration:none}a:active,a:hover{background-color:#7A991A}</style>",d='<ul> <li><a href="" ng-click="fullscreen()">See fullscreen</a></li> </ul>',e=c+'<div ng-scope-element="'+b+'">'+d+"</div>";return{template:e,restrict:"EA",scope:{src:"@",height:"=?",width:"=?",speed:"=?",resolution:"=?",controls:"=?"},link:function(c,d,e){function f(){B&&h(),J.update(),requestAnimationFrame(f),F.render(D,E)}function g(a,b){E.aspect=a/b,E.fov=Math.max(40,Math.min(100,E.fov)),E.updateProjectionMatrix()}function h(){(y!==a.innerWidth||z!==a.innerHeight)&&(y=a.innerWidth,z=a.innerHeight,g(y,z),F.setSize(y,z))}function i(a){a.preventDefault(),a.wheelDeltaY?E.fov-=.05*a.wheelDeltaY:a.wheelDelta?E.fov-=.05*a.wheelDelta:a.detail&&(E.fov+=1*a.detail),E.fov=Math.max(40,Math.min(100,E.fov)),E.updateProjectionMatrix()}var j=640,k=480,l=0,m=0,n=20,o=30,p=80,q=10,r="all",s=["all","wheel","pointer","none"],t=Math.max(Math.min(e.speed,n),m)||l,u=e.width||j,v=e.height||k,w=Math.max(Math.min(e.resolution,p),q)||o,x=-.5*t,y=a.innerWidth,z=a.innerHeight,A=e.controls||r,B=!1;-1===s.indexOf(A)&&(A=r);var C=c[b],D=new THREE.Scene,E=new THREE.PerspectiveCamera(75,u/v,1,1e3);E.position.x=.1,E.fov=1;var F=Detector.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer;F.setSize(u,v);var G=new THREE.SphereGeometry(100,w,w),H=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(e.src)}),I=new THREE.Mesh(G,H);I.scale.x=-1,D.add(I);var J=new THREE.OrbitControls(E,C);("wheel"===A||"none"===A)&&(J.enabled=!1),J.noPan=!0,J.noZoom=!0,J.autoRotate=!0,J.autoRotateSpeed=x,C.append(F.domElement),f(),c.fullscreen=function(){B?(g(u,v),F.setSize(u,v),C[0].style.position="",document.documentElement.style.overflow="auto",document.body.scroll="yes"):(g(u,v),F.setSize(y,z-28),C[0].style.position="absolute",C[0].style.left="0px",C[0].style.top="0px",window.scrollTo(0,0),document.documentElement.style.overflow="hidden",document.body.scroll="no"),B=B?!1:!0},("all"===A||"wheel"===A)&&(C.bind("mousewheel",i),C.bind("DOMMouseScroll",i))}}}]),THREE.OrbitControls=function(a,b){function c(){return 2*Math.PI/60/60*p.autoRotateSpeed}function d(){return Math.pow(.95,p.zoomSpeed)}function e(){p.autoRotateSpeed=0}function f(a){clearTimeout(o),o=setTimeout(function(){p.autoRotateSpeed=-.5},a)}function g(a){if(e(),p.enabled!==!1){if(a.preventDefault(),0===a.button){if(p.noRotate===!0)return;G=F.ROTATE,r.set(a.clientX,a.clientY)}else if(1===a.button){if(p.noZoom===!0)return;G=F.DOLLY,x.set(a.clientX,a.clientY)}else if(2===a.button){if(p.noPan===!0)return;G=F.PAN,u.set(a.clientX,a.clientY)}p.domElement.bind("mousemove",h),p.domElement.bind("mouseup",i)}}function h(a){if(p.enabled!==!1){a.preventDefault();var b=p.domElement===document?p.domElement.body:p.domElement;if(G===F.ROTATE){if(p.noRotate===!0)return;s.set(a.clientX,a.clientY),t.subVectors(s,r),p.rotateLeft(2*Math.PI*t.x/b[0].clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*t.y/b[0].clientHeight*p.rotateSpeed),r.copy(s)}else if(G===F.DOLLY){if(p.noZoom===!0)return;y.set(a.clientX,a.clientY),z.subVectors(y,x),z.y>0?p.dollyIn():p.dollyOut(),x.copy(y)}else if(G===F.PAN){if(p.noPan===!0)return;v.set(a.clientX,a.clientY),w.subVectors(v,u),p.pan(w),u.copy(v)}p.update()}}function i(){f(5500),p.enabled!==!1&&(p.domElement.unbind("mousemove"),p.domElement.unbind("mouseup"),G=F.NONE)}function j(a){if(p.enabled!==!1&&p.noZoom!==!0){var b=0;a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail),b>0?p.dollyOut():p.dollyIn()}}function k(a){if(p.enabled!==!1&&p.noKeys!==!0&&p.noPan!==!0){var b=!1;switch(a.keyCode){case p.keys.UP:p.pan(new THREE.Vector2(0,p.keyPanSpeed)),b=!0;break;case p.keys.BOTTOM:p.pan(new THREE.Vector2(0,-p.keyPanSpeed)),b=!0;break;case p.keys.LEFT:p.pan(new THREE.Vector2(p.keyPanSpeed,0)),b=!0;break;case p.keys.RIGHT:p.pan(new THREE.Vector2(-p.keyPanSpeed,0)),b=!0}b&&p.update()}}function l(a){if(e(),p.enabled!==!1)switch(a.touches.length){case 1:if(p.noRotate===!0)return;G=F.TOUCH_ROTATE,r.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(p.noZoom===!0)return;G=F.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);x.set(0,d);break;case 3:if(p.noPan===!0)return;G=F.TOUCH_PAN,u.set(a.touches[0].pageX,a.touches[0].pageY);break;default:G=F.NONE}}function m(a){if(p.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=p.domElement===document?p.domElement.body:p.domElement;switch(a.touches.length){case 1:if(p.noRotate===!0)return;if(G!==F.TOUCH_ROTATE)return;s.set(a.touches[0].pageX,a.touches[0].pageY),t.subVectors(s,r),p.rotateLeft(2*Math.PI*t.x/b[0].clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*t.y/b[0].clientHeight*p.rotateSpeed),r.copy(s);break;case 2:if(p.noZoom===!0)return;if(G!==F.TOUCH_DOLLY)return;var c=a.touches[0].pageX-a.touches[1].pageX,d=a.touches[0].pageY-a.touches[1].pageY,e=Math.sqrt(c*c+d*d);y.set(0,e),z.subVectors(y,x),z.y>0?p.dollyOut():p.dollyIn(),x.copy(y);break;case 3:if(p.noPan===!0)return;if(G!==F.TOUCH_PAN)return;v.set(a.touches[0].pageX,a.touches[0].pageY),w.subVectors(v,u),p.pan(w),u.copy(v);break;default:G=F.NONE}}}function n(){f(5500),p.enabled!==!1&&(G=F.NONE)}this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var o,p=this,q=1e-6,r=new THREE.Vector2,s=new THREE.Vector2,t=new THREE.Vector2,u=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,y=new THREE.Vector2,z=new THREE.Vector2,A=0,B=0,C=1,D=new THREE.Vector3,E=new THREE.Vector3,F={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},G=F.NONE,H={type:"change"};this.rotateLeft=function(a){void 0===a&&(a=c()),B+=a},this.rotateUp=function(a){void 0===a&&(a=c()),A+=a},this.panLeft=function(a){var b=new THREE.Vector3,c=this.object.matrix.elements;b.set(c[0],c[1],c[2]),b.multiplyScalar(-a),D.add(b)},this.panUp=function(a){var b=new THREE.Vector3,c=this.object.matrix.elements;b.set(c[4],c[5],c[6]),b.multiplyScalar(a),D.add(b)},this.pan=function(a){var b=p.domElement===document?p.domElement.body:p.domElement;if(void 0!==p.object.fov){var c=p.object.position,d=c.clone().sub(p.target),e=d.length();e*=Math.tan(p.object.fov/2*Math.PI/180),p.panLeft(2*a.x*e/b[0].clientHeight),p.panUp(2*a.y*e/b[0].clientHeight)}else void 0!==p.object.top?(p.panLeft(a.x*(p.object.right-p.object.left)/b[0].clientWidth),p.panUp(a.y*(p.object.top-p.object.bottom)/b[0].clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(a){void 0===a&&(a=d()),C/=a},this.dollyOut=function(a){void 0===a&&(a=d()),C*=a},this.update=function(){var a=this.object.position,b=a.clone().sub(this.target),d=Math.atan2(b.x,b.z),e=Math.atan2(Math.sqrt(b.x*b.x+b.z*b.z),b.y);this.autoRotate&&this.rotateLeft(c()),d+=B,e+=A,e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(q,Math.min(Math.PI-q,e));var f=b.length()*C;f=Math.max(this.minDistance,Math.min(this.maxDistance,f)),this.target.add(D),b.x=f*Math.sin(e)*Math.sin(d),b.y=f*Math.cos(e),b.z=f*Math.sin(e)*Math.cos(d),a.copy(this.target).add(b),this.object.lookAt(this.target),B=0,A=0,C=1,D.set(0,0,0),E.distanceTo(this.object.position)>0&&(this.dispatchEvent(H),E.copy(this.object.position))},this.domElement.bind("contextmenu",function(a){a.preventDefault()}),this.domElement.bind("mousedown",g),this.domElement.bind("mousewheel",j),this.domElement.bind("DOMMouseScroll",j),this.domElement.bind("keydown",k),this.domElement.bind("touchstart",l),this.domElement.bind("touchend",n),this.domElement.bind("touchmove",m)},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.id="webgl-error-message",a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.fontWeight="normal",a.style.textAlign="center",a.style.background="#fff",a.style.color="#000",a.style.padding="1.5em",a.style.width="400px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=void 0!==a.parent?a.parent:document.body,c=void 0!==a.id?a.id:"oldie",d=Detector.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}};